package sivl.platform.common.filter;import java.io.IOException;import javax.servlet.FilterChain;import javax.servlet.ServletException;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.springframework.web.filter.OncePerRequestFilter;import sivl.platform.common.constant.Constant;import sivl.platform.common.constant.CErrorCode;import sivl.platform.common.service.SysParamService;import sivl.platform.common.utils.HttpClientUtils;import sivl.platform.common.utils.SimpleUtil;import sivl.platform.common.utils.SpringContextUtil;/** * session过滤器<br/> * 目的：对用户进行安全校验校验 * @author lixuefeng * @createTime 2015年11月30日 * @version 1.0 */public class SessionFilter extends OncePerRequestFilter {	//系统参数服务	private SysParamService sysParamService = SpringContextUtil.getBean(SysParamService.class);		@Override	protected void doFilterInternal(HttpServletRequest request,			HttpServletResponse response, FilterChain filterChain)			throws ServletException, IOException {		//请求uri		String url = request.getRequestURI();		String needFilterUrls = sysParamService.getValue(Constant.LOGIN_FILTER_URL.getKey());		String[] needFilterUrl = needFilterUrls.split("\\|");		boolean doFilter = isDoFilter(needFilterUrl, url);		if(doFilter){			//是否传入签名			Object obj = request.getSession().getAttribute(SimpleUtil.getUserSessionKey(request));			String returnFmt = HttpClientUtils.getRequestFormat(request);//数据返回格式			if(null == obj){				//用户seesion已经不存在，进行登录跳转				HttpClientUtils.handErrorResponse(request, response, returnFmt, "请重新登录！",CErrorCode.error501);				return;			}		}		filterChain.doFilter(request, response);  	}		/**	 * 需要进行过滤	 * @param needFilter	 * @param url	 * @return boolean	 */	public boolean isDoFilter(String[] needFilter ,String url){		//不需要进行过滤校验		boolean result = false;		for(String filter : needFilter){			if(url.indexOf(filter) != -1){				//需要进行过滤校验				return true;			}		}		return result;	}}