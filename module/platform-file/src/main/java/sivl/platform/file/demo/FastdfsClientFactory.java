package sivl.platform.file.demo;import java.util.List;import org.apache.commons.pool2.impl.GenericKeyedObjectPool;import org.apache.commons.pool2.impl.GenericKeyedObjectPoolConfig;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import sivl.platform.file.demo.client.StorageClient;import sivl.platform.file.demo.client.StorageClientFactory;import sivl.platform.file.demo.client.TrackerClient;import sivl.platform.file.demo.client.TrackerClientFactory;/** *  * 主要功能：FastdfsClient的工厂类 * @author liuli * @creationDate 2015年5月22日 下午2:35:23 */public class FastdfsClientFactory {    private static Logger logger = LoggerFactory.getLogger(FastdfsClientFactory.class);		private static volatile FastdfsClient fastdfsClient;    private static FastdfsClientConfig config = null;      public FastdfsClientFactory() {    	    }        /**     *      * 功能说明：获取FastdfsClient对象     * @author liuli     * @creationDate 2015年5月22日 下午2:30:41     * @return FastdfsClient     */    public static FastdfsClient getFastdfsClient(){        if (fastdfsClient == null) {            synchronized (FastdfsClient.class) {                if (fastdfsClient == null) {                    try {                        config = new FastdfsClientConfig();                    } catch (Exception e) {                        logger.warn("Load fastdfs config failed.",e);                    }                    int connectTimeout = config.getConnectTimeout();                    int networkTimeout = config.getNetworkTimeout();                    TrackerClientFactory trackerClientFactory = new TrackerClientFactory(connectTimeout, networkTimeout);                    StorageClientFactory storageClientFactory = new StorageClientFactory(connectTimeout, networkTimeout);                    GenericKeyedObjectPoolConfig trackerClientPoolConfig = config.getTrackerClientPoolConfig();                    GenericKeyedObjectPoolConfig storageClientPoolConfig = config.getStorageClientPoolConfig();                    GenericKeyedObjectPool<String,TrackerClient> trackerClientPool = new GenericKeyedObjectPool<String,TrackerClient>(trackerClientFactory, trackerClientPoolConfig);                    GenericKeyedObjectPool<String,StorageClient> storageClientPool = new GenericKeyedObjectPool<String,StorageClient>(storageClientFactory, storageClientPoolConfig);                    List<String> trackerAddrs = config.getTrackerAddrs();                    fastdfsClient = new FastdfsClientImpl(trackerAddrs,trackerClientPool,storageClientPool);                }            }        }        return fastdfsClient;    }}