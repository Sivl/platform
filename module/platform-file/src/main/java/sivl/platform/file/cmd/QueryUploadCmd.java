package sivl.platform.file.cmd;import java.io.IOException;import java.io.UnsupportedEncodingException;import java.net.Socket;import java.util.Arrays;import sivl.platform.file.model.FileResultModel;import sivl.platform.file.model.FileUploadStorageModel;import sivl.platform.file.utils.BityUtils;/** * 查询上传命令 * 目的： * @author lixuefeng * @date 2016年1月7日 * @version 1.0 */public class QueryUploadCmd extends AbstractCmd<FileUploadStorageModel>  {		@Override	public FileResultModel<FileUploadStorageModel> exec(Socket socket) throws IOException {		request(socket.getOutputStream());		Response response = response(socket.getInputStream());		if(response.isSuccess()){			byte[] data = response.getData();			String ip_addr = new String(data,FDFS_GROUP_NAME_MAX_LEN,FDFS_IPADDR_SIZE - 1).trim();			int port = (int) BityUtils.buff2long(data,FDFS_GROUP_NAME_MAX_LEN	+ FDFS_IPADDR_SIZE - 1);			byte storePath = data[TRACKER_QUERY_STORAGE_STORE_BODY_LEN - 1];			FileUploadStorageModel uploadStorage = new FileUploadStorageModel(ip_addr+":"+String.valueOf(port), storePath);			return new FileResultModel<FileUploadStorageModel>(response.getCode(),uploadStorage);		}else{			return new FileResultModel<FileUploadStorageModel>(response.getCode(),"Error");		}	}	public QueryUploadCmd() {		super();		this.requestCmd = TRACKER_PROTO_CMD_SERVICE_QUERY_STORE_WITHOUT_GROUP_ONE;		this.responseCmd = TRACKER_PROTO_CMD_RESP;		this.responseSize = TRACKER_QUERY_STORAGE_STORE_BODY_LEN;	}		public QueryUploadCmd(String group) throws UnsupportedEncodingException {		super();		int group_len;		byte[] bs = group.getBytes(charset);		body = new byte[FDFS_GROUP_NAME_MAX_LEN];		if (bs.length <= FDFS_GROUP_NAME_MAX_LEN) {			group_len = bs.length;		} else {			group_len = FDFS_GROUP_NAME_MAX_LEN;		}		Arrays.fill(body, (byte) 0);		System.arraycopy(bs, 0, body, 0, group_len);		this.requestCmd = TRACKER_PROTO_CMD_SERVICE_QUERY_STORE_WITH_GROUP_ONE;		this.responseCmd = TRACKER_PROTO_CMD_RESP;		this.responseSize = TRACKER_QUERY_STORAGE_STORE_BODY_LEN;	}	}